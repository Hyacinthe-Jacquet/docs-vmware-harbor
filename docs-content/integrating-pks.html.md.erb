---
title: Integrating VMware Harbor Registry with PKS
owner: Partners
---

This topic describes how to integrate VMware Harbor Registry with Pivotal Container Service (PKS).
Before you install and configure Harbor, and before creating a PKS cluster, you must provide the Harbor CA certificate to Ops Manager so that PKS clusters can use authenticated connections to push and pull images to and from Harbor.

##<a id='obtain'></a> Step 1: Obtain the Harbor CA Certificate File

* If you used a third-party CA to sign the Harbor certificate, obtain the CA certificate from your third-party CA.
    
* If you used an automatically generated certificate for Harbor, do the following:
     1. Navigate to the Ops Manager Installation Dashboard.
     2. Click your username in the Ops Manager banner and select **Settings**.
     2. Click **Advanced**.
     3. Click **Download Root CA Cert**.

##<a id='ca-cert'></a> Step 2: Provide the Harbor CA Certificate to Ops Manager

1. From the Ops Manager Installation Dashboard, click the **BOSH Director** tile.
1. Click **Security**.
1. Open the CA certificate file in a text editor.
1. Copy and paste the contents of the CA certificate file into the **Trusted Certificates** field.
1. Click **Save**.

##<a id='ip-add'></a> Step 3: Obtain Harbor IP Address (NSX-T)

If you integrate Harbor with PKS in an NSX-T environment, the IP address for Harbor provided by Ops Manager is inaccessible, so you cannot access the  Harbor UI from `https://harbor_host_address:443`. 

To access the Harbor UI, you must create a DNAT rule in the T0-Router that maps the Harbor IP address to a routable IP address in your virtual network.

Follow the steps below to create this DNAT rule.

1. In the NSX Manager, select **Routing > NAT > T0-Router**.
1. Click **ADD**.
1. Configure the NAT rule as follows:
    * **Priority**: `1024`
    * **Action**: `DNAT`
    * **Protocol**: `Any Protocol`
    * **Destination IP**: The external IP address that your FQDN resolves to
    * **Translated IP**: The IP address of the Harbor VM
    * **Status**: `Enabled`
    * **Firewall Bypass**: `Enabled`
  
    <img src="harbor-dnat.png" alt="NSX-T NAT Rule for Harbor" width="425">

<p class='note'><strong>Note</strong>: The IP address that the FQDN resolves to should be in the range of the NSX-T <code>external-ip-pool</code> (<strong>Inventory > Groups > IP Pools</strong>). If the IP address is not in this range, you must assign an IP address from the CIDR that is outside of the specified range in use for <code>external-ip-pool</code>.</p>