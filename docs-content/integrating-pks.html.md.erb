---
title: Integrating VMware Harbor Registry with PKS
owner: Partners
---

This topic describes how to integrate VMware Harbor Registry with Pivotal Container Service (PKS).
Before you install and configure Harbor, and before creating a PKS cluster, you must provide the Harbor CA certificate to Ops Manager so that PKS clusters can use authenticated connections to push and pull images to and from Harbor.

##<a id='obtain'></a> Step 1: Obtain the Harbor CA Certificate File

* If you used a third-party CA to sign the Harbor certificate, obtain the CA certificate from your third-party CA.
    
* If you used an automatically generated certificate for Harbor, do the following:
     1. Navigate to the Ops Manager Installation Dashboard.
     2. Click your username in the Ops Manager banner and select **Settings**.
     2. Click **Advanced**.
     3. Click **Download Root CA Cert**.

##<a id='ca-cert'></a> Step 2: Provide the Harbor CA Certificate to Ops Manager

1. From the Ops Manager Installation Dashboard, click the **BOSH Director** tile.
1. Click **Security**.
1. Open the CA certificate file in a text editor.
1. Copy and paste the contents of the CA certificate file into the **Trusted Certificates** field.
1. Click **Save**.

##<a id='ip-add'></a> Step 3: Obtain Harbor IP address (NSX-T).

If you are integrating Harbor with PKS in an NSX-T environment, the IP address for Habor given by OpsManager will not be accessible. In other words, navigating to <https://harbor_host_address:443> will not launch the Harbor UI. In this case you will need to create a DNAT rule in the T0-Router that maps the Harbor IP to a routable IP in your virtual network.

To to this, in the NSX Manager, select **Routing > NAT > T0-Router** and click **ADD**.

Configure the NAT rule as follows:

    Priority `1024`
    Action `DNAT`
    Protocol `Any Protocol`
    Destination IP `<external IP your FQDN resolves to>`
    Translated IP: `<IP of the Harbor VM>`
    Status: `Enabled`
    Firewall Bypass: `Enabled` (edited)

<img src="harbor-dnat.png" alt="NSX-T NAT Rule for Harbor" width="425">

Note that the IP address that the FQDN resolves to must be in the range of the NSX-T `external-ip-pool` (**Inventory > Groups > IP Pools**). Otherwise you will have to pick an IP address from that CIDR but outside of the specified range in use for `external-ip-pool`.